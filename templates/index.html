<!-- Styles -->
<style>
  #chartdiv {
    width: 100%;
    height: 100%;
  }
  #searchBar {
    margin: 0 auto;
    display: block;
  }
</style>

<link href="http://easyautocomplete.com/dist/easy-autocomplete.min.css" rel="stylesheet">
<link href="http://easyautocomplete.com/dist/easy-autocomplete.themes.min.css" rel="stylesheet">

<!-- Resources -->
<script src="https://www.amcharts.com/lib/4/core.js"></script>
<script src="https://www.amcharts.com/lib/4/charts.js"></script>
<script src="https://www.amcharts.com/lib/4/plugins/forceDirected.js"></script>
<script src="https://www.amcharts.com/lib/4/themes/animated.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="http://easyautocomplete.com/dist/jquery.easy-autocomplete.min.js"></script>

<!-- Chart code -->
<script>

var options = {
    url: function(query) {
      return "/api/search?query="+query;
    },
    getValue: "name",

    template: {
      type: "description",
      fields: {
          description: "year"
      }
    },

    list: {
        match: {
            enabled: true
        },
        onChooseEvent: function() {
          var id = $("#searchBar").getSelectedItemData().id;
          console.log(id);
        }	
    },

    theme: "square",
    
    requestDelay: 100
  };

  $("#searchBar").easyAutocomplete(options);
  
  fetch("?id=4352")
    .then(function (response) {
      response.text().then(function (text) {
        var jsonFile = text;
        am4core.ready(function () {

          // Themes begin
          am4core.useTheme(am4themes_animated);
          // Themes end

          var chart = am4core.create("chartdiv", am4plugins_forceDirected.ForceDirectedTree);
          var networkSeries = chart.series.push(new am4plugins_forceDirected.ForceDirectedSeries())


          console.log(jsonFile)
          console.log("it did get here")
          chart.data = [JSON.parse(jsonFile)]

          networkSeries.dataFields.value = "id";
          networkSeries.dataFields.name = "name";
          networkSeries.dataFields.children = "children";
          networkSeries.nodes.template.tooltipText = "{name}:{id}";
          networkSeries.nodes.template.fillOpacity = 1;
          networkSeries.manyBodyStrength = -20;
          networkSeries.links.template.strength = 0.8;
          networkSeries.minRadius = am4core.percent(3);

          networkSeries.nodes.template.label.text = "{name}"
          networkSeries.fontSize = 10;

        }); // end am4core.ready()
      });
    });

</script>

<input id="searchBar" placeholder="Enter a movie, games, book, music artist..."/>

<!-- HTML -->
<div id="chartdiv"></div>